# Prisma Migration Guide

‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ **Prisma + SQLite Database** ‡πÅ‡∏ó‡∏ô localStorage ‡πÅ‡∏•‡πâ‡∏ß! üéâ

## ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á

### ‡πÄ‡∏î‡∏¥‡∏° (localStorage)
- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô browser localStorage
- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏ö browser data
- ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ sync ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡πâ‡∏≤‡∏° device ‡πÑ‡∏î‡πâ

### ‡πÉ‡∏´‡∏°‡πà (Prisma + SQLite)
- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô SQLite database (`prisma/dev.db`)
- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏≤‡∏ß‡∏£ persistent ‡∏ö‡∏ô server
- ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ deploy production
- ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô PostgreSQL/MySQL ‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï

## ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Database

### Tables
1. **FoodEntry** - ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏°‡∏∑‡πâ‡∏≠
   - id, name, calories, meal, date, nutrition info
   
2. **UserSettings** - ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
   - goal (‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà)
   - macro_goals (‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£)
   
3. **InBodyAnalysis** - ‡∏ú‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå InBody
   - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ upload ‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå

## ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

### Development

```bash
# ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies (‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥)
npm install

# Generate Prisma Client
npm run prisma:generate

# Run migrations
npm run prisma:migrate

# Start dev server
npm run dev

# ‡πÄ‡∏õ‡∏¥‡∏î Prisma Studio (GUI ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏π/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç database)
npm run prisma:studio
```

### Production Build

```bash
npm run build
npm start
```

## API Routes

### Food Entries
- `GET /api/food-entries?date=YYYY-MM-DD` - ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
- `POST /api/food-entries` - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà
- `PUT /api/food-entries` - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£
- `DELETE /api/food-entries?id=xxx` - ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£

### Settings
- `GET /api/settings?key=goal` - ‡∏î‡∏∂‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
- `POST /api/settings` - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤

### InBody Analysis
- `GET /api/inbody` - ‡∏î‡∏∂‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ InBody
- `POST /api/inbody` - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÉ‡∏´‡∏°‡πà
- `DELETE /api/inbody?id=xxx` - ‡∏•‡∏ö‡∏ú‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå

### History
- `GET /api/history?limit=30` - ‡∏î‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

## Migration ‡∏à‡∏≤‡∏Å localStorage

‚ö†Ô∏è **‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç**: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡πÉ‡∏ô localStorage ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å migrate ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤ ‡∏°‡∏µ 2 ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:

### ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà 1: Export/Import Manual
1. ‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï: ‡πÄ‡∏õ‡∏¥‡∏î browser console ‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ô:
```javascript
// Export data
const data = {
  goal: localStorage.getItem('calcount_goal'),
  macroGoals: localStorage.getItem('calcount_macro_goals'),
  inbody: localStorage.getItem('calcount_inbody_history'),
  days: {}
};

// Export all day data
for (let i = 0; i < 60; i++) {
  const date = new Date();
  date.setDate(date.getDate() - i);
  const dateStr = date.toISOString().split('T')[0];
  const dayData = localStorage.getItem(`calcount_${dateStr}`);
  if (dayData) {
    data.days[dateStr] = dayData;
  }
}

console.log(JSON.stringify(data, null, 2));
// Copy output ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå
```

2. ‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï: ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ Prisma Studio ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô script import ‡πÄ‡∏Ç‡πâ‡∏≤ database

### ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà 2: ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á 2 ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏π‡πà‡∏Å‡∏±‡∏ô
- `lib/storage.ts` = localStorage (‡πÄ‡∏Å‡πà‡∏≤)
- `lib/storageDb.ts` = Prisma Database (‡πÉ‡∏´‡∏°‡πà)

‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÉ‡∏ä‡πâ `lib/storageDb.ts` ‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÉ‡∏ä‡πâ `lib/storage.ts` ‡πÑ‡∏î‡πâ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß

## ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Database Schema

‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç database schema:

1. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `prisma/schema.prisma`
2. Run migration:
```bash
npx prisma migrate dev --name describe_your_changes
```
3. Generate Prisma Client ‡πÉ‡∏´‡∏°‡πà:
```bash
npx prisma generate
```

## Deploy to Production

### Option 1: Vercel (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)
1. Install Vercel CLI: `npm i -g vercel`
2. Deploy: `vercel`
3. ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô database ‡πÄ‡∏õ‡πá‡∏ô PostgreSQL:
   - ‡πÄ‡∏û‡∏¥‡πà‡∏° Vercel Postgres
   - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `datasource db` ‡πÉ‡∏ô `schema.prisma`
   - Run migration: `npx prisma migrate deploy`

### Option 2: Docker
```dockerfile
FROM node:22-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npx prisma generate
RUN npm run build
CMD ["npm", "start"]
```

## Backup Database

```bash
# Backup
cp prisma/dev.db prisma/dev.db.backup

# Restore
cp prisma/dev.db.backup prisma/dev.db
```

## ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏û‡∏ö

### ‚ùå "Database dev.db does not exist"
**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ**: Run `npx prisma migrate dev`

### ‚ùå "PrismaClient is unable to run in this browser environment"
**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏**: ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÉ‡∏ä‡πâ PrismaClient ‡πÉ‡∏ô client component
**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ**: ‡πÉ‡∏ä‡πâ API routes ‡πÅ‡∏ó‡∏ô (‡∏ã‡∏∂‡πà‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡πÅ‡∏•‡πâ‡∏ß)

### ‚ùå "Failed to fetch" ‡∏´‡∏£‡∏∑‡∏≠ API errors
**‡πÄ‡∏ä‡πá‡∏Ñ**:
1. Dev server ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà (`npm run dev`)
2. Database file ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà (`prisma/dev.db`)
3. ‡πÄ‡∏õ‡∏¥‡∏î browser console ‡∏î‡∏π error details

## ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°

### Prisma Studio
Prisma Studio ‡∏Ñ‡∏∑‡∏≠ GUI tool ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏π/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç database:
```bash
npm run prisma:studio
```
‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î browser ‡∏ó‡∏µ‡πà `http://localhost:5555`

### Database File Location
- Development: `prisma/dev.db`
- ‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å ignore ‡πÉ‡∏ô git (`.gitignore`)
- ‡∏Ñ‡∏ß‡∏£ backup ‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥

## Resources

- [Prisma Documentation](https://www.prisma.io/docs)
- [Next.js with Prisma](https://www.prisma.io/nextjs)
- [SQLite Documentation](https://www.sqlite.org/docs.html)

---

‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢ AI Assistant ü§ñ
Last updated: February 6, 2026
